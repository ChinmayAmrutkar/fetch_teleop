<launch>
  <!-- Argument to choose method: 'twist' or 'runstop' -->
  <arg name="method" default="twist" />

  <!-- METHOD A: Twist Filter -->
  <group if="$(eval arg('method') == 'twist')">
    <node pkg="fetch_teleop" type="safety_controller_twist.py" name="safety_twist" output="screen" />
    
    <!-- For Twist Method, we remap teleop to /cmd_vel_teleop so the node can intercept it -->
    <node pkg="teleop_twist_keyboard" type="teleop_twist_keyboard.py" name="teleop_keyboard" output="screen">
      <remap from="cmd_vel" to="cmd_vel_teleop" />
    </node>
  </group>

  <!-- METHOD B: Runstop Trigger -->
  <group if="$(eval arg('method') == 'runstop')">
    <node pkg="fetch_teleop" type="safety_controller_runstop.py" name="safety_runstop" output="screen" />
    
    <!-- For Runstop Method, Teleop talks DIRECTLY to robot. The safety node interrupts from the side. -->
    <node pkg="teleop_twist_keyboard" type="teleop_twist_keyboard.py" name="teleop_keyboard" output="screen">
      <!-- No remapping needed, talks to /cmd_vel directly -->
    </node>
  </group>
</launch>