<launch>
  <!-- ARGUMENTS -->
  <!-- Ensure this default path matches where you saved the map in Phase 1 -->
  <arg name="map_file" default="~/chinmay/fetch_teleop_ws/my_maps/lab_map_2025-12-10-15-19-28.yaml" />
  <arg name="mocap_ip" default="192.168.0.127" /> <!-- CHANGE THIS TO OPTITRACK IP -->
  <arg name="rigid_body" default="Fetch" />

  <!-- 1. Fetch Navigation Stack -->
  <!-- REPLACED: Instead of calling map_server and amcl separately, we use the standard Fetch launcher. -->
  <!-- This starts: Map Server, AMCL, and Move Base -->
  <include file="$(find fetch_navigation)/launch/fetch_nav.launch">
    <arg name="map_file" value="$(arg map_file)" />
  </include>

  <!-- 2. VRPN Client (Optitrack) -->
  <node pkg="vrpn_client_ros" type="vrpn_client_node" name="vrpn_client_node" output="screen">
    <rosparam subst_value="true">
      server: $(arg mocap_ip)
      port: 3883
      update_frequency: 100.0
      frame_id: world
      use_server_time: false
      broadcast_tf: true
      refresh_tracker_frequency: 1.0
    </rosparam>
  </node>

  <!-- 3. Pose Logger (Analysis) -->
  <node pkg="fetch_teleop" type="pose_logger.py" name="pose_logger" output="screen">
    <param name="rigid_body_name" value="$(arg rigid_body)" />
    <!-- Tunable offsets if frames aren't perfectly aligned -->
    <param name="offset_x" value="0.0" />
    <param name="offset_y" value="0.0" />
  </node>
  
  <!-- NOTE: In a separate terminal, run: 
       roslaunch fetch_teleop safety.launch method:=delayed 
  -->
</launch>
